<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <!-- Additional mobile meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#2D1B3D" />
    <title>Telegram Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/animations.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "game-purple": "#2D1B3D",
              "game-pink": "#E91E63",
              "game-gold": "#FFD700",
              "game-ruby": "#E53E3E",
            },
            fontFamily: {
              game: ["Arial", "sans-serif"],
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Gugi&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        width: 100%;
        /* Safari mobile viewport fix */
        height: 100vh;
        height: 100dvh; /* Dynamic viewport height for modern browsers */
        overflow: hidden; /* Prevent scrolling that can trigger address bar */
      }

      body {
        font-family: "Arial", sans-serif;
        background-color: #120106;
        min-height: 100vh;
        min-height: 100dvh; /* Dynamic viewport height */
        width: 100vw;
        display: block;
        position: relative;
        color: white;
        /* Safari specific fixes */
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: none; /* Prevent bounce scrolling */
      }

      /* Main container positioned in center like a phone */
      .phone-container {
        max-width: 375px;
        width: 100%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        min-height: 100vh;
        min-height: 100dvh; /* Dynamic viewport height */
        max-height: 100vh;
        max-height: 100dvh; /* Dynamic viewport height */
        display: flex;
        flex-direction: column;
        background: linear-gradient(180deg, #2d1b3d 0%, #1a0f2e 100%);
        background-image: url("./images/screen1/background-image.png");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        border-radius: 16px;
        overflow: hidden;
      }

      /* Safari mobile specific fixes */
      @supports (-webkit-touch-callout: none) {
        /* Safari only styles */
        html,
        body {
          height: -webkit-fill-available;
          height: calc(var(--vh, 1vh) * 100); /* Use custom property */
        }

        .phone-container {
          min-height: -webkit-fill-available;
          max-height: -webkit-fill-available;
          min-height: calc(var(--vh, 1vh) * 100);
          max-height: calc(var(--vh, 1vh) * 100);
        }

        /* Force full height on Safari */
        .game-container {
          height: -webkit-fill-available;
          height: calc(var(--vh, 1vh) * 100);
        }
      }

      /* iOS Safari viewport fix */
      @media screen and (max-width: 428px) {
        .phone-container {
          border-radius: 0;
          top: 0;
          left: 0;
          transform: none;
          position: fixed;
          width: 100vw;
          height: 100vh;
          height: 100dvh;
          height: calc(var(--vh, 1vh) * 100); /* Use custom property */
          max-width: 100vw;
        }

        /* Safari specific height fix */
        @supports (-webkit-touch-callout: none) {
          .phone-container {
            height: -webkit-fill-available;
            height: calc(var(--vh, 1vh) * 100);
          }
        }
      }

      /* Additional mobile Safari fixes */
      @media screen and (max-width: 428px) and (-webkit-min-device-pixel-ratio: 2) {
        /* High DPI mobile devices (iPhone, etc.) */
        body {
          position: fixed;
          width: 100%;
          height: 100%;
          overflow: hidden;
        }

        .phone-container {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
        }

        /* Prevent rubber band scrolling */
        .game-container {
          overscroll-behavior: none;
          -webkit-overscroll-behavior: none;
        }
      }

      /* Landscape orientation fixes for mobile */
      @media screen and (max-width: 926px) and (orientation: landscape) {
        .phone-container {
          height: 100vh;
          height: calc(var(--vh, 1vh) * 100);
          max-height: 100vh;
          max-height: calc(var(--vh, 1vh) * 100);
        }

        /* Adjust main stage for landscape */
        #main-stage {
          height: 200px;
        }

        /* Adjust character overlay for landscape */
        #character-overlay {
          bottom: 160px !important;
        }

        /* Adjust bottom layout for landscape */
        .bottom-layout-image {
          bottom: -40px !important;
        }
      }

      .progress-bar {
        background: linear-gradient(90deg, #e45f90 0%, #f06292 100%);
        height: 8px;
      }

      .progress-icon {
        position: absolute;
        border-radius: 0.5px;
        background: linear-gradient(0deg, #bac1d6 0.01%, #ffffff 99.98%);
        width: 5.5px;
        height: 14px;
        top: -1px;
        transition: left 0.3s ease;
      }

      .stage-platform {
        background: conic-gradient(
          from 0deg,
          #e91e63,
          #f8bbd9,
          #e91e63,
          #f8bbd9,
          #e91e63
        );
        border-radius: 50%;
      }

      .curtain-bg {
        background: linear-gradient(
          180deg,
          #8b4513 0%,
          #654321 50%,
          #3e2723 100%
        );
      }
      #main-stage {
        position: relative;
        z-index: 30;
      }
      .background-color-gradient {
        background: radial-gradient(
          50% 50% at 50% 50%,
          #450832 0%,
          #2e032c 100%
        );
        backdrop-filter: blur(10px);
        border: 1px solid;
        border: 1px solid rgba(215, 12, 163, 0.42);
      }
      .background-bottom-nav {
        background-color: #27012a;
        border: 1px solid;
        border: 1px solid rgba(215, 12, 163, 0.42);
      }
      .resource-header {
        height: 30px;
      }
      .level-bars {
        background-color: #4ade806b;
        height: 12px;
      }
      .gugi-regular {
        font-family: "Gugi", sans-serif;
        font-weight: 400;
        font-style: normal;
      }

      /* Auto earn button styles */
      #auto-earn-button.active {
        background: radial-gradient(
          50% 50% at 50% 50%,
          #450832 0%,
          #2e032c 100%
        );
      }
      #auto-earn-button:not(.active) {
        background: radial-gradient(
          50% 50% at 50% 50%,
          rgba(69, 8, 50, 0.5) 0%,
          rgba(46, 3, 44, 0.5) 100%
        );
      }

      /* Auto earn button default position - override all media queries */
      .flex.justify-end.mr-4.mb-4.relative.z-50 {
        position: absolute !important;
        bottom: 180px !important; /* Position below character's feet */
        right: 16px !important;
        margin: 0 !important;
        transform: none !important;
        z-index: 45 !important; /* Below character but above bottom layout */
      }

      /* HIGH PRIORITY OVERRIDE - Must be last to override all media queries */
      .game-container .flex.justify-end.mr-4.mb-4.relative.z-50 {
        position: absolute !important;
        bottom: 180px !important; /* Position below character's feet */
        right: 16px !important;
        margin: 0 !important;
        transform: none !important;
        z-index: 45 !important;
      }

      /* Auto earn button responsive positioning based on character position */
      @media screen and (max-width: 375px) {
        .flex.justify-end.mr-4.mb-4.relative.z-50,
        .game-container .flex.justify-end.mr-4.mb-4.relative.z-50 {
          bottom: 160px !important; /* Adjust for smaller character on iPhone SE */
        }
      }

      @media screen and (min-width: 376px) and (max-width: 390px) {
        .flex.justify-end.mr-4.mb-4.relative.z-50,
        .game-container .flex.justify-end.mr-4.mb-4.relative.z-50 {
          bottom: 170px !important; /* Adjust for medium phones */
        }
      }

      @media screen and (min-width: 391px) {
        .flex.justify-end.mr-4.mb-4.relative.z-50,
        .game-container .flex.justify-end.mr-4.mb-4.relative.z-50 {
          bottom: 190px !important; /* Adjust for larger phones */
        }
      }

      /* Landscape orientation adjustments for auto earn button */
      @media screen and (max-width: 926px) and (orientation: landscape) {
        .flex.justify-end.mr-4.mb-4.relative.z-50,
        .game-container .flex.justify-end.mr-4.mb-4.relative.z-50 {
          bottom: 120px !important; /* Adjust for landscape mode */
        }
      }

      /* Portrait mode optimization for auto earn button */
      @media screen and (max-height: 700px) {
        .flex.justify-end.mr-4.mb-4.relative.z-50,
        .game-container .flex.justify-end.mr-4.mb-4.relative.z-50 {
          bottom: 140px !important; /* Adjust for shorter screens */
        }
      }

      /* Telegram WebApp Styles */
      .in-telegram-app {
        max-width: 100%;
        margin: 0 auto;
        overflow-x: hidden;
        height: 100vh;
      }

      /* Game container */
      .game-container {
        width: 100%;
        height: 100%;
        padding: 20px 16px;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 1;
      }

      /* Base styles for smallest phones (iPhone SE, small Android) */
      @media screen and (max-width: 375px) {
        .phone-container {
          max-width: 100%;
          border-radius: 0;
          top: 0;
          left: 0;
          transform: none;
          position: fixed;
        }

        .resource-header {
          height: 24px;
        }

        #main-stage {
          height: 240px;
          background-position: center bottom -2px;
        }

        .text-lg {
          font-size: 0.875rem;
        }

        .px-4 {
          padding-left: 8px;
          padding-right: 8px;
        }
      }

      /* Styles for medium phones (iPhone X, 11, 12, 13, most Android) */
      @media screen and (min-width: 376px) and (max-width: 390px) {
        .phone-container {
          max-width: 390px;
        }

        .resource-header {
          height: 26px;
        }

        #main-stage {
          height: 260px;
          background-size: auto 85%;
        }

        .text-lg {
          font-size: 0.925rem;
        }

        .px-4 {
          padding-left: 10px;
          padding-right: 10px;
        }

        /* Character overlay adjustments for iPhone 12 Pro */
        #character-overlay {
          bottom: 200px !important;
        }

        /* Bottom layout adjustments for iPhone 12 Pro */
        .bottom-layout-image {
          bottom: -20px !important;
        }
      }

      /* Styles for larger phones (iPhone Pro Max, larger Android) */
      @media screen and (min-width: 391px) {
        .phone-container {
          max-width: 428px;
        }

        .resource-header {
          height: 28px;
        }

        #main-stage {
          height: 280px;
          background-size: auto 85%;
        }

        /* Character overlay adjustments for iPhone 14 Pro Max */
        #character-overlay {
          bottom: 210px !important;
        }

        /* Bottom layout adjustments for iPhone 14 Pro Max */
        .bottom-layout-image {
          bottom: -25px !important;
        }
      }

      /* Specific adjustments for iPhone 15 Pro (393x852) */
      @media screen and (min-width: 390px) and (max-width: 395px) and (min-height: 844px) {
        .phone-container {
          max-width: 393px;
          border-radius: 0;
          top: 0;
          left: 0;
          transform: none;
          position: fixed;
        }

        /* Bottom navigation specific for iPhone 15 Pro */
        #bottom-nav {
          bottom: 34px !important; /* Account for home indicator */
          z-index: 30 !important;
          padding-bottom: 10px !important;
        }

        /* Character overlay adjustments for iPhone 15 Pro */
        #character-overlay {
          bottom: 220px !important;
        }

        /* Bottom layout adjustments for iPhone 15 Pro */
        .bottom-layout-image {
          bottom: -15px !important;
        }

        /* Auto earn button adjustments for iPhone 15 Pro */
        .flex.justify-end.mr-4.mb-4.relative.z-50 {
          transform: translateY(40px) !important;
        }
      }

      /* General iPhone adjustments for devices with home indicator */
      @media screen and (min-width: 375px) and (min-height: 812px) {
        #bottom-nav {
          bottom: 34px !important; /* Safe area for home indicator */
          padding-bottom: 10px !important;
        }
      }

      /* Portrait mode optimization for shorter screens */
      @media screen and (max-height: 700px) {
        .phone-container {
          border-radius: 0;
          top: 0;
          left: 0;
          transform: none;
          position: fixed;
        }

        .pt-6 {
          padding-top: 0.75rem;
        }

        #main-stage {
          height: 220px;
          background-size: auto 85%;
        }

        .mb-4 {
          margin-bottom: 0.5rem;
        }
      }

      /* Common mobile adjustments */
      @media screen and (max-width: 428px) {
        .level-bars {
          height: 8px;
        }

        .progress-icon {
          height: 12px;
        }

        /* ƒêi·ªÅu ch·ªânh kho·∫£ng c√°ch */
        .space-x-4 > * + * {
          margin-left: 0.75rem;
        }
      }

      /* Bottom layout adjustments */
      .bottom-layout-image {
        z-index: 10;
      }

      /* Bottom layout flash effect */
      .bottom-layout-flash {
        position: relative;
        overflow: hidden;
      }

      /* Additional glow effect - gi·ªØ nguy√™n hi·ªáu ·ª©ng g·ªëc */
      .bottom-layout-flash.flash-active {
        filter: brightness(1.8) drop-shadow(0 0 40px rgba(255, 255, 255, 1))
          drop-shadow(0 0 80px rgba(255, 255, 255, 0.8));
        animation: pulseGlow 0.8s ease-out;
      }

      /* Mobile-specific flash effect fallback - ch·ªâ √°p d·ª•ng khi drop-shadow kh√¥ng ho·∫°t ƒë·ªông */
      @media screen and (max-width: 768px) {
        /* Ki·ªÉm tra n·∫øu drop-shadow kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£ t·ªët tr√™n mobile */
        @supports not (filter: drop-shadow(0 0 40px rgba(255, 255, 255, 1))) {
          .bottom-layout-flash.flash-active {
            filter: brightness(2.2) saturate(1.3) !important;
            animation: mobileFlash 0.8s ease-out !important;
            transform: scale(1.02);
          }
        }

        /* Fallback cho c√°c thi·∫øt b·ªã mobile c√≥ performance th·∫•p */
        .bottom-layout-flash.flash-active {
          /* Th√™m transform ƒë·ªÉ tƒÉng c∆∞·ªùng hi·ªáu ·ª©ng tr√™n mobile */
          transform: scale(1.01);
          transition: transform 0.1s ease;
        }
      }

      /* Bounce effect for bottom layout when tapping */
      .bottom-layout-flash.flash-active img {
        animation: bottomLayoutBounce 0.8s ease-out;
      }

      /* Character press down effect when tapping */
      #character-overlay.character-press {
        animation: characterPressDown 0.8s ease-out;
      }

      @keyframes bottomLayoutBounce {
        0% {
          transform: translateX(-12px) translateY(0px);
        }
        15% {
          transform: translateX(-12px) translateY(15px);
        }
        30% {
          transform: translateX(-12px) translateY(0px);
        }
        45% {
          transform: translateX(-12px) translateY(8px);
        }
        60% {
          transform: translateX(-12px) translateY(0px);
        }
        75% {
          transform: translateX(-12px) translateY(3px);
        }
        100% {
          transform: translateX(-12px) translateY(0px);
        }
      }

      @keyframes pulseGlow {
        0% {
          filter: brightness(1) drop-shadow(0 0 0px rgba(255, 255, 255, 0));
        }
        30% {
          filter: brightness(2.2) drop-shadow(0 0 60px rgba(255, 255, 255, 1))
            drop-shadow(0 0 120px rgba(255, 255, 255, 0.9));
        }
        60% {
          filter: brightness(1.8) drop-shadow(0 0 40px rgba(255, 255, 255, 0.8))
            drop-shadow(0 0 80px rgba(255, 255, 255, 0.6));
        }
        100% {
          filter: brightness(1) drop-shadow(0 0 0px rgba(255, 255, 255, 0));
        }
      }

      @keyframes characterPressDown {
        0% {
          transform: translateY(0px);
        }
        15% {
          transform: translateY(15px);
        }
        30% {
          transform: translateY(0px);
        }
        45% {
          transform: translateY(8px);
        }
        60% {
          transform: translateY(0px);
        }
        75% {
          transform: translateY(3px);
        }
        100% {
          transform: translateY(0px);
        }
      }

      @keyframes mobileFlash {
        0% {
          filter: brightness(1) saturate(1);
          transform: scale(1);
        }
        30% {
          filter: brightness(2.5) saturate(1.5);
          transform: scale(1.03);
        }
        60% {
          filter: brightness(2) saturate(1.3);
          transform: scale(1.02);
        }
        100% {
          filter: brightness(1) saturate(1);
          transform: scale(1);
        }
      }

      /* Styles cho web th∆∞·ªùng */
      .standalone-web {
        max-width: 960px;
        margin: 0 auto;
      }

      /* Telegram WebApp Responsive Styles */

      /* Base styles for smallest phones (iPhone SE) */
      @media screen and (max-width: 375px) {
        .resource-header {
          height: 24px;
        }

        #main-stage {
          height: 240px;
          background-size: auto 85%;
          transform: translateY(15px);
        }

        .text-lg {
          font-size: 0.875rem;
        }

        .px-4 {
          padding-left: 8px;
          padding-right: 8px;
        }

        .space-x-3 > * + * {
          margin-left: 0.5rem;
        }

        .mb-4 {
          margin-bottom: 0.75rem;
        }
      }

      /* Styles for medium phones (iPhone X, 11, 12, 13, most Android) */
      @media screen and (min-width: 376px) and (max-width: 390px) {
        .resource-header {
          height: 26px;
        }

        #main-stage {
          height: 260px;
          background-size: auto 85%;
        }

        .text-lg {
          font-size: 0.925rem;
        }

        .px-4 {
          padding-left: 10px;
          padding-right: 10px;
        }
      }

      /* Styles for larger phones (iPhone Pro Max, larger Android) */
      @media screen and (min-width: 391px) {
        .resource-header {
          height: 30px;
        }

        #main-stage {
          height: 315px;
          background-size: auto 85%;
        }

        .text-lg {
          font-size: 1rem;
        }
      }

      /* Portrait mode optimization */
      @media screen and (max-height: 700px) {
        .pt-6 {
          padding-top: 0.75rem;
        }

        #main-stage {
          height: 220px;
          background-size: auto 85%;
        }

        .mb-4 {
          margin-bottom: 0.5rem;
        }
      }

      /* Safari safe area adjustments */
      @supports (padding: max(0px)) {
        #bottom-nav {
          padding-bottom: max(10px, env(safe-area-inset-bottom)) !important;
          bottom: max(5px, env(safe-area-inset-bottom)) !important;
        }

        .phone-container {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
      }

      /* Prevent text selection and context menu on mobile */
      .phone-container {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        -webkit-touch-callout: none;
        -webkit-tap-highlight-color: transparent;
      }

      /* Ensure smooth scrolling and prevent bounce */
      .phone-container,
      .game-container {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: none;
        -webkit-overscroll-behavior: none;
      }

      /* Fix for Safari address bar issue - final override */
      @media screen and (max-device-width: 428px) {
        .phone-container {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          width: 100vw !important;
          height: 100vh !important;
          height: calc(var(--vh, 1vh) * 100) !important;
          transform: none !important;
          border-radius: 0 !important;
          max-width: 100vw !important;
          max-height: 100vh !important;
          max-height: calc(var(--vh, 1vh) * 100) !important;
        }
      }

      /* Force bottom-nav to be visible on all devices */
      #bottom-nav {
        position: fixed !important;
        bottom: 5px !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 50 !important;
        padding: 0 16px !important;
        pointer-events: auto !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
      }

      /* Ensure bottom-nav content is visible */
      #bottom-nav > div {
        background-color: #27012a !important;
        border: 1px solid rgba(215, 12, 163, 0.42) !important;
        border-radius: 9999px !important;
        padding: 16px !important;
        display: flex !important;
        justify-content: space-around !important;
        align-items: center !important;
      }

      /* iPhone with home indicator adjustments */
      @media screen and (min-height: 812px) {
        #bottom-nav {
          bottom: 34px !important;
          padding-bottom: 10px !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Phone Container -->
    <div class="phone-container">
      <!-- Game Container -->
      <div class="game-container">
        <!-- Resource Header -->
        <div class="flex space-x-3 mb-4">
          <!-- Ruby Counter -->
          <div
            class="resource-header background-color-gradient flex-1 rounded-full px-4 py-3 flex items-center space-x-3"
          >
            <div class="w-5 h-5 rounded-full flex items-center justify-center">
              <img
                src="./images/screen1/icons/ruby-icon.svg"
                alt="Ruby Icon"
                class="w-5 h-5"
              />
            </div>
            <span class="gugi-regular text-white font-bold text-lg">0</span>
          </div>

          <!-- Coin Counter -->
          <div
            class="resource-header background-color-gradient flex-1 rounded-full px-4 py-3 flex items-center space-x-3"
          >
            <div class="w-5 h-5 rounded-full flex items-center justify-center">
              <img
                src="./images/screen1/icons/coin-icon.svg"
                alt="Coin Icon"
                class="w-5 h-5"
                id="coin-target"
              />
            </div>
            <span
              id="coin-count"
              class="gugi-regular text-white font-bold text-lg"
              >0</span
            >
          </div>
        </div>

        <!-- Stats Panel -->
        <div
          id="stats-panel"
          class="background-color-gradient bg-opacity-30 rounded-2xl p-4 mb-4 relative"
        >
          <!-- HP Section -->
          <div class="mb-4 flex items-center justify-between gap-6">
            <div class="flex flex-col justify-between items-center mb-2 w-full">
              <div class="flex items-center justify-between w-full mb-2">
                <span class="gugi-regular text-[#FF6B8B]">HP</span>
                <span id="hp-per-level" class="gugi-regular text-white"
                  >100/100</span
                >
              </div>
              <div class="w-full h-3 relative">
                <div class="hp-progress-container">
                  <div class="progress-bar"></div>
                  <div class="progress-icon"></div>
                </div>
              </div>
            </div>
            <div
              class="flex flex-col items-center px-2 py-3 rounded-[12px] w-[100px]"
              style="background-color: #fc376621"
            >
              <img
                src="./images/screen1/icons/coin-icon.svg"
                alt="Point Icon"
                class="w-5 h-5"
                id="coin-target-stats"
              />
              <span id="coin-earn" class="gugi-regular text-white font-bold"
                >0</span
              >
            </div>
          </div>
          <div
            style="
              width: 319px;
              height: 1.5px;
              background: radial-gradient(
                closest-side at 50% 50%,
                rgba(249, 238, 246, 0.35) 0%,
                rgba(215, 12, 163, 0) 100%
              );
              margin: 16px auto;
            "
          ></div>
          <!-- Level Bars -->
          <div class="flex space-x-4">
            <div class="flex-1">
              <div class="flex justify-between items-center mb-2">
                <span class="gugi-regular text-[#FF6B8B]">HP lv</span>
                <span id="hp-level" class="gugi-regular text-white font-bold"
                  >1/100</span
                >
              </div>
              <div class="relative level-bars w-full">
                <div class="hp-level-progress-container">
                  <div class="level-progress-bar"></div>
                  <div class="level-progress-icon"></div>
                </div>
              </div>
            </div>

            <div class="flex-1">
              <div class="flex justify-between items-center mb-2">
                <span class="gugi-regular text-[#FF6B8B]">MT lv</span>
                <span id="lp-level" class="gugi-regular text-white font-bold"
                  >1/100</span
                >
              </div>
              <div class="relative level-bars w-full">
                <div class="lp-level-progress-container">
                  <div class="level-progress-bar"></div>
                  <div class="level-progress-icon"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Event Button and Game 2 Button -->
        <div class="flex justify-end space-x-4">
          <!-- Event Button -->
          <div
            class="background-color-gradient rounded-xl flex justify-center w-[104px]"
          >
            <button class="pt-3 flex flex-col items-center justify-center">
              <span class="gugi-regular text-white text-xs font-bold"
                >Ïù¥Î≤§Ìä∏</span
              >
              <img
                src="./images/screen1/icons/event-icon.svg"
                alt="Event Icon"
                class="w-[65px] h-[65px]"
              />
            </button>
          </div>

          <!-- Game 2 Button -->
        </div>

        <!-- Main Stage Area -->
        <div id="main-stage" class="relative h-[290px] z-30">
          <!-- Character will appear here with highest z-index -->
        </div>
      </div>

      <div class="flex justify-end mr-4 mb-4 relative z-50">
        <div class="flex flex-col items-center space-y-2">
          <button
            id="auto-earn-button"
            class="py-3 flex flex-col items-center justify-center background-color-gradient rounded-xl w-[48px]"
          >
            <img
              src="./images/screen1/icons/auto-earn.svg"
              alt="Event Icon"
              class="w-[22px] h-[22px]"
            />
          </button>
          <span class="gugi-regular text-[#FF6B8B] text-xs font-bold"
            >Auto earn</span
          >
        </div>
      </div>

      <!-- Character overlay to appear above bottom layout -->
      <div
        id="character-overlay"
        class="absolute bottom-[240px] left-0 right-0 z-40 pointer-events-none"
      >
        <div
          class="w-full h-[280px] bg-no-repeat bg-center bg-contain"
          style="
            background-image: url('./images/screen1/character.svg');
            background-position: center bottom;
            background-size: auto 90%;
          "
        ></div>
      </div>

      <!-- Add coin container for flying coins -->
      <div id="coin-container" class="coin-container"></div>

      <!-- Tap area behind bottom layout -->
      <div
        class="absolute bottom-0 left-0 right-0 h-[200px] z-5"
        id="bottom-tap-area"
        style="pointer-events: auto"
      ></div>

      <!-- Bottom Layout Image -->
      <div
        class="absolute bottom-0 left-0 right-0 flex justify-center items-center pointer-events-none z-10 bottom-layout-image bottom-layout-flash"
        id="bottom-layout-container"
      >
        <img
          src="./images/screen1/bottom-layout.png"
          alt="Bottom Layout"
          class="w-[104%] max-w-md object-contain"
          style="transform: translateX(-12px)"
        />
      </div>

      <!-- Bottom Navigation -->
      <div id="bottom-nav" class="absolute bottom-5 left-0 right-0 px-4 z-20">
        <div
          class="flex justify-around items-center py-4 px-4 background-bottom-nav rounded-full"
        >
          <button class="">
            <image
              src="./images/screen1/icons/shopping-cart-icon.svg"
              alt="Shopping Cart Icon"
              class="w-6 h-6 text-game-pink"
            />
          </button>

          <button class="">
            <image
              src="./images/screen1/icons/refresh-icon.svg"
              alt="Refresh Icon"
              class="w-6 h-6 text-game-pink"
            />
          </button>

          <button class="">
            <image
              src="./images/screen1/icons/wallet-icon.svg"
              alt="Wallet Icon"
              class="w-6 h-6 text-game-pink"
            />
          </button>

          <button class="">
            <image
              src="./images/screen1/icons/star-icon.svg"
              alt="Star Icon"
              class="w-6 h-6 text-game-pink"
            />
          </button>

          <button class="">
            <image
              src="./images/screen1/icons/building-icon.svg"
              alt="Building Icon"
              class="w-6 h-6 text-game-pink"
            />
          </button>
        </div>
      </div>
    </div>

    <script>
      // Game logic will go here
      console.log("Telegram Game Loaded");

      // Example: Handle navigation clicks
      document
        .querySelectorAll("#bottom-nav button")
        .forEach((button, index) => {
          button.addEventListener("click", () => {
            // Add navigation logic here
          });
        });

      // Flying coin effect is handled in taptoearn.js tap function
      // No need for separate click listener here
    </script>
    <script src="./js/taptoearn.js"></script>
    <script src="./js/telegram-integration.js"></script>

    <!-- Level Up Popup -->
    <div id="level-up-popup" class="level-up-popup">
      <div class="level-up-content">
        <div class="level-up-emoji">üéâ</div>
        <div class="level-up-text-container">
          <div class="level-up-title">Level Up!</div>
          <div class="level-up-description">
            New rewards unlocked and stronger power await you.
          </div>
        </div>
        <button
          id="level-up-confirm-btn"
          class="level-up-button"
          onclick="closeLevelUpPopupInline(event)"
        >
          <span class="level-up-button-text">Confirm</span>
        </button>
      </div>
    </div>

    <script>
      // ƒê·ªãnh nghƒ©a h√†m ƒë√≥ng popup tr·ª±c ti·∫øp trong HTML
      function closeLevelUpPopupInline(event) {
        console.log("closeLevelUpPopupInline called");

        // NgƒÉn event bubbling v√† default behavior
        if (event) {
          event.preventDefault();
          event.stopPropagation();
          event.stopImmediatePropagation();
        }

        const popup = document.getElementById("level-up-popup");
        if (popup) {
          console.log("Hiding popup inline");
          popup.classList.remove("show");
          popup.style.display = "none";
          popup.style.opacity = "0";
          popup.style.visibility = "hidden";
          popup.style.pointerEvents = "none";
          console.log("Popup hidden successfully");
        } else {
          console.error("Popup not found in inline function!");
        }

        return false; // NgƒÉn th√™m event propagation
      }

      // Test function
      function testPopup() {
        console.log("Testing popup");
        const popup = document.getElementById("level-up-popup");
        if (popup) {
          popup.style.display = "flex";
          popup.style.opacity = "1";
          popup.style.visibility = "visible";
          popup.style.pointerEvents = "auto";
          popup.classList.add("show");
          console.log("Test popup shown");
        }
      }

      // Safari viewport fix - Handle address bar show/hide
      function handleSafariViewport() {
        // Set CSS custom property for actual viewport height
        const setViewportHeight = () => {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty("--vh", `${vh}px`);
        };

        // Initial set
        setViewportHeight();

        // Update on resize (when address bar shows/hides)
        let resizeTimer;
        window.addEventListener("resize", () => {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(setViewportHeight, 100);
        });

        // Update on orientation change
        window.addEventListener("orientationchange", () => {
          setTimeout(setViewportHeight, 500);
        });

        // Prevent scrolling that can trigger address bar
        document.addEventListener(
          "touchmove",
          (e) => {
            if (e.target.closest(".phone-container")) {
              e.preventDefault();
            }
          },
          { passive: false }
        );

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener(
          "touchend",
          (e) => {
            const now = new Date().getTime();
            if (now - lastTouchEnd <= 300) {
              e.preventDefault();
            }
            lastTouchEnd = now;
          },
          false
        );
      }

      // Initialize Safari viewport fix
      if (
        /Safari/.test(navigator.userAgent) &&
        /Mobile/.test(navigator.userAgent)
      ) {
        handleSafariViewport();
      }
    </script>
  </body>
</html>
